# Autodoc E2E Test Report — Online Boutique

**Generated:** 2026-02-15
**Target repo:** GoogleCloudPlatform/microservices-demo (11 microservices, 5+ languages)
**Autodoc binary:** autodoc v0.1.0
**LLM:** claude-sonnet-4-5-20250929 (Anthropic)
**Embeddings:** gemini-embedding-001 (Google)

---

## Execution Summary

| Metric | Value |
|--------|-------|
| Files found | 146 |
| Files processed | 109 (75%) |
| Files failed | 37 (Anthropic credit exhaustion at ~75%) |
| Tokens used | 506,642 input / 107,488 output |
| Cost | $3.13 |
| Generation time | 20m 4s |
| Markdown docs generated | 110 |
| Vector DB size | 4.8 MB |
| architecture.md | Missing (credits exhausted) |
| Enhanced index.md | Fell back to basic (credits exhausted) |

### Missing Services (due to credit exhaustion)
- **productcatalogservice** — all files failed
- **recommendationservice** — all files failed
- **shippingservice** — all files failed
- **shoppingassistantservice** — all files failed
- **paymentservice** — server.js, proto files failed (charge.js succeeded)

### Services Fully Indexed
- adservice, cartservice, checkoutservice, currencyservice, emailservice, frontend, loadgenerator

---

## Scoring Rubric

### Track A: Retrieval Quality (`autodoc query --json`, per question 0-10)
- **Relevance (0-4):** How many of top-5 results are actually relevant?
- **Coverage (0-3):** Do results contain the critical files needed?
- **Ranking (0-3):** Is the most important file ranked #1-2?

### Track B: Answer Quality (`/api/search` synthesized answer, per question 0-10)
**Note:** LLM synthesis was unavailable (Anthropic credits exhausted). Track B scores reflect retrieval quality only via the content summaries returned. No synthesized answers were generated.

### Aggregate
- Max 100 per track. Grade: 90+ Excellent, 75-89 Good, 60-74 Acceptable, 40-59 Below Average, <40 Poor

---

## Results

### Q1 (Difficulty 1/5) — Basic Facts

**Question:** What programming languages are used in this project?

**Ground Truth:** Go, Node.js, Python, C#, Java, Protocol Buffers. Must name 6 languages and associate them with services.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type | Language Signal |
|------|------|-----------|------|----------------|
| 1 | src/frontend/static/images/credits.txt | 0.586 | file | None |
| 2 | src/cartservice/src/cartservice.csproj | 0.584 | file | C# |
| 3 | src/loadgenerator/requirements.in | 0.580 | file | Python |
| 4 | src/adservice/settings.gradle | 0.578 | file | Java |
| 5 | src/frontend/.gitkeep | 0.576 | file | None |

Also in top 10: Protobuf (rank 6), Go (rank 8), Node.js/JS (rank 10)

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 3/4 | 3 of top-5 directly show a language; 2 are noise (credits.txt, .gitkeep) |
| Coverage | 3/3 | All 6 languages appear in top 10: C# (2), Python (3), Java (4), Protobuf (6), Go (8), Node.js (10) |
| Ranking | 1/3 | Most useful files not in top 2; credits.txt at #1 is irrelevant |
| **Total A** | **7/10** | Good coverage across top 10, but ranking is weak |

---

### Q2 (Difficulty 2/5) — Basic Facts

**Question:** What port does the frontend service listen on and what HTTP routes does it expose?

**Ground Truth:** Port 8080. Routes include `/`, `/product/{id}`, `/cart`, `/cart/checkout`, `/setCurrency`, `/_healthz`.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type | Symbol |
|------|------|-----------|------|--------|
| 1 | src/frontend/main.go | 0.713 | function | `main` |
| 2 | src/frontend/main.go | 0.664 | file | — |
| 3 | src/frontend/main.go | 0.663 | class | `frontendServer` |
| 4 | src/frontend/handlers.go | 0.651 | file | — |
| 5 | src/frontend/deployment_details.go | 0.644 | file | — |

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 4/4 | All top-5 are frontend files; main.go and handlers.go directly contain port and routes |
| Coverage | 3/3 | main.go has port config; handlers.go has all route handlers |
| Ranking | 3/3 | main.go `main` function (where port is set + routes registered) is #1 |
| **Total A** | **10/10** | Perfect retrieval |

---

### Q3 (Difficulty 2/5) — Architecture

**Question:** How do the microservices communicate with each other?

**Ground Truth:** gRPC over Protocol Buffers defined in `protos/demo.proto`. Frontend translates HTTP to gRPC. Service discovery via env vars.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type |
|------|------|-----------|------|
| 1 | protos/demo.proto | 0.617 | file |
| 2 | src/adservice/src/main/proto/demo.proto | 0.612 | file |
| 3 | src/frontend/genproto/demo_grpc.pb.go | 0.602 | file |
| 4 | src/emailservice/demo_pb2_grpc.py | 0.593 | file |
| 5 | src/frontend/genproto/demo.pb.go | 0.588 | file |

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 4/4 | All 5 results show gRPC/protobuf communication |
| Coverage | 3/3 | proto definitions + generated gRPC code + multiple languages |
| Ranking | 3/3 | protos/demo.proto (the canonical source) is #1 |
| **Total A** | **10/10** | Perfect retrieval |

---

### Q4 (Difficulty 2/5) — Architecture

**Question:** What is the role of Redis in this architecture and which service uses it?

**Ground Truth:** Redis is used by cartservice (C#) for shopping cart persistence, keyed by user ID.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type | Symbol |
|------|------|-----------|------|--------|
| 1 | src/cartservice/src/cartstore/RedisCartStore.cs | 0.633 | file | — |
| 2 | protos/demo.proto | 0.611 | file | — |
| 3 | src/cartservice/src/Startup.cs | 0.610 | file | — |
| 4 | src/adservice/src/main/proto/demo.proto | 0.608 | file | — |
| 5 | src/cartservice/src/cartstore/RedisCartStore.cs | 0.606 | class | `RedisCartStore` |

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 4/4 | 3 of 5 are directly about Redis/cartservice; summaries explicitly mention Redis + cart persistence |
| Coverage | 3/3 | RedisCartStore.cs (implementation), Startup.cs (configuration), Cart.proto (API) |
| Ranking | 3/3 | RedisCartStore.cs is #1 — exactly the right file |
| **Total A** | **10/10** | Perfect retrieval |

---

### Q5 (Difficulty 4/5) — Cross-Service Tracing

**Question:** Trace the complete flow when a user places an order. Which services are involved and in what sequence?

**Ground Truth:** Frontend -> CheckoutService orchestrates: Cart -> ProductCatalog -> Currency -> Shipping -> Payment -> Cart.EmptyCart -> Email. 7-8 services total.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type | Symbol |
|------|------|-----------|------|--------|
| 1 | src/checkoutservice/main.go | 0.685 | file | — |
| 2 | src/adservice/src/main/proto/demo.proto | 0.655 | file | — |
| 3 | protos/demo.proto | 0.648 | file | — |
| 4 | src/frontend/genproto/demo.pb.go | 0.643 | class | `PlaceOrderRequest` |
| 5 | src/loadgenerator/locustfile.py | 0.642 | function | `checkout` |

Summary for #1 says: "orchestrates order placement by coordinating with multiple downstream services (cart, product catalog, currency, shipping, email, and payment)"

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 4/4 | All top-5 relevant to checkout flow |
| Coverage | 2/3 | checkoutservice/main.go covers the orchestration; missing individual service impls (shipping, payment lost to credit exhaustion) |
| Ranking | 3/3 | checkoutservice/main.go at #1 — the orchestrator file |
| **Total A** | **9/10** | Excellent; summary explicitly lists all services in the flow |

---

### Q6 (Difficulty 4/5) — Blast Radius

**Question:** What happens if the currency service goes down? Which services are directly and indirectly affected?

**Ground Truth:** Directly: Frontend (price display), CheckoutService (price conversion). Indirectly: all downstream checkout services. Currency is critical in both browsing and purchasing paths.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type | Symbol |
|------|------|-----------|------|--------|
| 1 | src/currencyservice/proto/demo.proto | 0.611 | file | — |
| 2 | src/currencyservice/data/currency_conversion.json | 0.609 | file | — |
| 3 | src/frontend/rpc.go | 0.603 | function | `getCurrencies` |
| 4 | src/loadgenerator/locustfile.py | 0.603 | function | `setCurrency` |
| 5 | src/adservice/src/main/proto/demo.proto | 0.602 | file | — |

Also: `convertCurrency` (rank 7), `_getCurrencyData` (rank 8)

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 3/4 | 3 of 5 directly about currency; loadgenerator is tangential |
| Coverage | 2/3 | Shows frontend->currency dependency (getCurrencies, convertCurrency) but misses checkoutservice/main.go (which also calls currency) |
| Ranking | 2/3 | Currency proto at #1 is relevant but getCurrencies/convertCurrency (the dependency evidence) are at 3 and 7 |
| **Total A** | **7/10** | Good for identifying the currency service itself; weaker at showing blast radius |

---

### Q7 (Difficulty 3/5) — Implementation Detail

**Question:** How does the recommendation service decide which products to suggest?

**Ground Truth:** Random selection via `random.sample()`. Fetches all products from ProductCatalogService, filters out current products, picks up to 5 randomly. No ML — it is a mock.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type | Symbol |
|------|------|-----------|------|--------|
| 1 | src/frontend/rpc.go | 0.654 | function | `getRecommendations` |
| 2 | src/frontend/templates/recommendations.html | 0.623 | file | — |
| 3 | src/frontend/genproto/demo.pb.go | 0.620 | class | `ListRecommendationsRequest` |
| 4 | src/frontend/genproto/demo.pb.go | 0.619 | class | `ListRecommendationsResponse` |
| 5 | src/adservice/.../AdService.java | 0.613 | function | `getAds` |

**Critical miss:** `src/recommendationservice/recommendation_server.py` (the actual implementation with `random.sample()`) was NOT indexed due to credit exhaustion.

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 3/4 | Top 4 are recommendation-related but from the consumer side (frontend), not the implementation |
| Coverage | 1/3 | Missing the critical file: recommendation_server.py (not indexed). Only shows frontend calling the service, not how it works internally |
| Ranking | 2/3 | getRecommendations at #1 is relevant but it's the frontend RPC wrapper, not the server logic |
| **Total A** | **6/10** | Hampered by missing service — would likely be 9/10 with full indexing |

---

### Q8 (Difficulty 3/5) — Implementation Detail

**Question:** What credit card validation does the payment service perform, and what card types are accepted?

**Ground Truth:** Three validations — card number format, card type (Visa + MasterCard only), expiration date. Returns mock UUID transaction.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type | Symbol |
|------|------|-----------|------|--------|
| 1 | src/paymentservice/charge.js | 0.662 | file | — |
| 2 | src/frontend/validator/validator.go | 0.653 | class | `PlaceOrderPayload` |
| 3 | src/paymentservice/charge.js | 0.650 | function | `charge` |
| 4 | src/paymentservice/charge.js | 0.644 | class | `UnacceptedCreditCard` |
| 5 | src/paymentservice/charge.js | 0.623 | class | `InvalidCreditCard` |

Summary for #4: "Error thrown when a credit card type is not accepted (only VISA and MasterCard allowed)"

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 4/4 | 4 of 5 directly about payment validation |
| Coverage | 3/3 | charge.js (implementation), charge function, UnacceptedCreditCard (Visa/MC only), InvalidCreditCard (format validation) |
| Ranking | 3/3 | charge.js at #1 and #3; validation classes at #4-5 |
| **Total A** | **10/10** | Perfect. Summaries explicitly mention "only VISA and MasterCard allowed" |

---

### Q9 (Difficulty 5/5) — Design Analysis

**Question:** What are the single points of failure in this architecture? Which service failures would cause a complete outage?

**Ground Truth:** Frontend = only true SPOF. ProductCatalogService = near-complete outage. CurrencyService = high blast radius. Must distinguish complete outage vs degraded experience.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type | Symbol |
|------|------|-----------|------|--------|
| 1 | src/emailservice/email_server.py | 0.582 | class | `HealthCheck` |
| 2 | src/adservice/src/main/proto/demo.proto | 0.576 | file | — |
| 3 | protos/demo.proto | 0.575 | file | — |
| 4 | src/cartservice/src/Startup.cs | 0.571 | file | — |
| 5 | src/adservice/.../AdService.java | 0.571 | function | `stop` |

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 2/4 | Results show health checks and service definitions, not failure analysis. Only 2 of 5 (proto files) are somewhat relevant to understanding dependencies |
| Coverage | 1/3 | Missing frontend/main.go (SPOF), productcatalogservice (not indexed), currencyservice dependency chain |
| Ranking | 0/3 | HealthCheck class at #1 is tangentially related but not the answer |
| **Total A** | **3/10** | This is an analytical question — retrieval alone cannot answer it well. Also hurt by missing services |

---

### Q10 (Difficulty 5/5) — Design Analysis

**Question:** If I wanted to add a wishlist feature, which services would I need to modify and what new gRPC methods would I need to define?

**Ground Truth:** New WishlistService (modeled after CartService), proto changes (AddItem, GetWishlist, RemoveItem RPCs), Frontend modifications, K8s manifests. CartService is the reference.

#### Track A: Top 5 Results

| Rank | File | Similarity | Type | Symbol |
|------|------|-----------|------|--------|
| 1 | src/cartservice/src/protos/Cart.proto | 0.712 | class | `CartService` |
| 2 | src/cartservice/src/protos/Cart.proto | 0.689 | file | — |
| 3 | protos/demo.proto | 0.676 | file | — |
| 4 | src/emailservice/demo_pb2_grpc.py | 0.674 | file | — |
| 5 | src/adservice/src/main/proto/demo.proto | 0.673 | file | — |

Also: CartService.cs (rank 9), AddItemRequest (ranks 8, 10)

#### Scoring

| Criteria | Score | Notes |
|----------|-------|-------|
| Relevance | 4/4 | Cart.proto and CartService at #1 is exactly the template for a wishlist service; proto files show how to define new gRPC services |
| Coverage | 2/3 | Cart proto (template), demo.proto (where to add new service), CartService.cs (implementation template). Missing frontend handlers as reference |
| Ranking | 3/3 | CartService proto at #1 (0.712 — highest similarity in all queries) — perfect reference for wishlist design |
| **Total A** | **9/10** | Excellent. System correctly identified CartService as the reference template |

---

## Summary Scorecard

| Question | Difficulty | Category | Track A (/10) | Notes |
|----------|-----------|----------|---------------|-------|
| Q1 | 1/5 | Basic Facts | 7 | Good coverage, weak ranking |
| Q2 | 2/5 | Basic Facts | 10 | Perfect — main.go at #1 |
| Q3 | 2/5 | Architecture | 10 | Perfect — demo.proto at #1 |
| Q4 | 2/5 | Architecture | 10 | Perfect — RedisCartStore at #1 |
| Q5 | 4/5 | Cross-Service Tracing | 9 | Excellent — checkoutservice/main.go orchestrator |
| Q6 | 4/5 | Blast Radius | 7 | Good for currency identification, weak on blast radius |
| Q7 | 3/5 | Implementation Detail | 6 | Hampered by missing recommendationservice |
| Q8 | 3/5 | Implementation Detail | 10 | Perfect — charge.js + validation classes |
| Q9 | 5/5 | Design Analysis | 3 | Retrieval-only can't answer analytical questions |
| Q10 | 5/5 | Design Analysis | 9 | Excellent — CartService as wishlist template |
| **Total** | | | **81/100** | |

### Track A Grade: **Good (81/100)**

### Track B: Not Scorable
LLM synthesis was unavailable due to Anthropic API credit exhaustion. The `/api/search` endpoint returned vector search results (identical to Track A) but no synthesized `answer` field. Track B would need a rerun with active API credits.

---

## Analysis

### What Worked Well
1. **Concrete implementation questions** (Q2, Q3, Q4, Q8) scored perfect 10/10 — the vector embeddings correctly identify specific files and functions
2. **Cross-service tracing** (Q5) scored 9/10 — checkoutservice/main.go summary explicitly lists all coordinated services
3. **Design reference** (Q10) scored 9/10 with highest similarity (0.712) — CartService proto correctly identified as wishlist template
4. **Function-level indexing** adds significant value — finding specific functions like `getCurrencies`, `charge`, `getRecommendations`

### What Didn't Work
1. **Analytical questions** (Q9: SPOFs) scored 3/10 — retrieval finds facts, not analysis. This is an inherent limitation of vector search without LLM synthesis
2. **Credit exhaustion** cost us 37 files including 4 entire services — Q7 (recommendation logic) was directly impacted
3. **Low similarity scores for broad questions** (Q1: 0.58 range vs Q10: 0.71 range) — generic questions produce weaker embeddings
4. **Blast radius analysis** (Q6) — the system finds what a service IS but struggles with what happens when it FAILS

### Estimated Scores with Full Indexing
- Q7 would likely be **9/10** (recommendation_server.py with random.sample() would rank #1)
- Q9 might improve to **5/10** (productcatalogservice indexed, but analytical gap remains)
- Overall: estimated **87/100** with full indexing — solidly "Good"

### Key Insight
The retrieval system excels at "what is this?" and "how does this work?" questions but struggles with "what if?" analytical questions. Track B (LLM synthesis) is critical for the harder questions — a rerun with active API credits would likely push Q6 and Q9 scores significantly higher.

---

## Reproduction

```bash
# Rerun queries only (skip generation, reuse existing docs):
# 1. Set ANTHROPIC_API_KEY and GOOGLE_API_KEY (or GEMINI_API_KEY)
# 2. cd to the cloned repo at: C:\Users\thesn\AppData\Local\Temp\online-boutique-e2e.TvH3RL\repo
# 3. autodoc query "your question" --json --limit 10

# Full rerun:
./test/e2e/online-boutique-e2e.sh --skip-cost-prompt
```

## File Locations

| Item | Path |
|------|------|
| CLI results | `C:\Users\thesn\AppData\Local\Temp\online-boutique-e2e.TvH3RL\_e2e_results\cli\q*.json` |
| API results | `C:\Users\thesn\AppData\Local\Temp\online-boutique-e2e.TvH3RL\_e2e_results\api\q*.json` |
| Generated docs | `C:\Users\thesn\AppData\Local\Temp\online-boutique-e2e.TvH3RL\repo\.autodoc\docs\` |
| Vector DB | `C:\Users\thesn\AppData\Local\Temp\online-boutique-e2e.TvH3RL\repo\.autodoc\vectordb\` |
| Generation log | `C:\Users\thesn\AppData\Local\Temp\claude\E--Development-auto-doc\tasks\b03c993.output` |
